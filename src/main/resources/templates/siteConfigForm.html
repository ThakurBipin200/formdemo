<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Site Config Form</title>
    <style>
        .field-container {
            margin-bottom: 10px;
        }
        .field-container button {
            margin-left: 10px;
        }
    </style>
</head>
<body>

<h2>Select Site</h2>
<form action="#" th:action="@{/site-configs/site{siteName}(siteName=${selectedSiteConfig?.siteName})}" method="get">
    <label for="siteSelect">Select Site Name:</label>
    <select id="siteSelect" name="siteName" th:onchange="this.form.submit()">
        <option value="" disabled selected>Select a site</option>
        <option th:each="site : ${siteConfigs}" th:value="${site.siteName}" th:text="${site.siteName}" th:selected="${site.siteName == selectedSiteConfig?.siteName}"></option>
    </select>
</form>

<div th:if="${selectedSiteConfig != null}">
    <h3>Site Config Details</h3>
    <form th:action="@{/site-configs/update}" th:object="${selectedSiteConfig}" method="post">
        <input type="hidden" th:field="*{siteName}" />

        <label for="headerVhost">Header VHost: </label>
        <input type="text" id="headerVhost" th:field="*{headerVhost}" /><br>

        <label for="siteProdDomain">Site Prod Domain: </label>
        <input type="text" id="siteProdDomain" th:field="*{siteProdDomain}" /><br>

        <label for="siteNonProdDomain">Site Non Prod Domain: </label>
        <input type="text" id="siteNonProdDomain" th:field="*{siteNonProdDomain}" /><br>

        <label for="aemSitePathEN">AEM Site Path EN: </label>
        <input type="text" id="aemSitePathEN" th:field="*{aemSitePathEN}" /><br>

        <label for="statFilesLevel">Stat Files Level: </label>
        <input type="text" id="statFilesLevel" th:field="*{statFilesLevel}" /><br>

        <!-- New Fields -->
        <label for="stateSpecificPage">State Specific Page: </label>
        <input type="checkbox" value="on" id="stateSpecificPage" th:field="*{stateSpecificPage}" th:checked="*{stateSpecificPage}" /><br>

        <label for="siteMapFeedSelector">Site Map Feed Selector: </label>
        <input type="text" id="siteMapFeedSelector" th:field="*{siteMapFeedSelector}" /><br>

        <!-- Multifield for DAM Transform Path -->
        <div id="damTransformPathContainer">
            <div th:each="path, iterStat : ${selectedSiteConfig.damTransformPath}">
                <div class="field-container" id="damTransformPathField-[[${iterStat.index}]]">
                    <label th:for="'damTransformPath' + ${iterStat.index}">DAM Transform Path (#{iterStat.index + 1}): </label>
                    <input type="text" th:id="'damTransformPath' + ${iterStat.index}" th:field="*{damTransformPath[__${iterStat.index}__]}" />
                    <button type="button" onclick="removeField(this, 'damTransformPathContainer')">Remove</button><br>
                </div>
            </div>
        </div>
        <button type="button" onclick="addField('damTransformPathContainer', 'damTransformPath', false)">Add DAM Transform Path</button><br>

        <!-- Multifield Dropdown for Languages -->
        <div id="languagesContainer">
            <div th:each="lang, iterStat : ${selectedSiteConfig.languages}">
                <div class="field-container" id="languagesField-[[${iterStat.index}]]">
                    <label th:for="'languages' + ${iterStat.index}">Language (#{iterStat.index + 1}): </label>
                    <select th:id="'languages' + ${iterStat.index}" th:field="*{languages[__${iterStat.index}__]}">
                        <option value="" disabled>Select Language</option>
                        <option value="EN">English</option>
                        <option value="ES">Spanish</option>
                        <option value="FR">French</option>
                        <!-- Add more languages as needed -->
                    </select>
                    <button type="button" onclick="removeField(this, 'languagesContainer')">Remove</button><br>
                </div>
            </div>
        </div>
        <button type="button" onclick="addField('languagesContainer', 'languages', true)">Add Language</button><br>

        <!-- Conditional Fields Based on Cache Check -->
        <label for="commonCacheCheck">Common Cache Check: </label>
        <input type="checkbox" value="on" id="commonCacheCheck" th:field="*{commonCacheCheck}" th:checked="*{commonCacheCheck}" onclick="togglePanel(this,'commonCachePanel')" /><br>

        <div id="commonCachePanel" style="display: none;">
            <div id="commonCachePathContainer">
                <div th:each="path, iterStat : ${selectedSiteConfig.commonCachePath}">
                    <div class="field-container" id="commonCachePathField-[[${iterStat.index}]]">
                        <label th:for="'commonCachePath' + ${iterStat.index}">Common Cache Path (#{iterStat.index + 1}): </label>
                        <input type="text" th:id="'commonCachePath' + ${iterStat.index}" th:field="*{commonCachePath[__${iterStat.index}__]}" />
                        <button type="button" onclick="removeField(this, 'commonCachePathContainer')">Remove</button><br>
                    </div>
                </div>
            </div>
            <button type="button" onclick="addField('commonCachePathContainer', 'commonCachePath', false)">Add Common Cache Path</button><br>

            <div id="commonDropdownContainer">
                <div th:each="dropdown, iterStat : ${selectedSiteConfig.commonDropdown}">
                    <div class="field-container" id="commonDropdownField-[[${iterStat.index}]]">
                        <label th:for="'commonDropdown' + ${iterStat.index}">Common Dropdown (#{iterStat.index + 1}): </label>
                        <select th:id="'commonDropdown' + ${iterStat.index}" th:field="*{commonDropdown[__${iterStat.index}__]}">
                            <option value="" disabled>Select Option</option>
                            <option value="Option1">Option 1</option>
                            <option value="Option2">Option 2</option>
                            <option value="Option3">Option 3</option>
                            <!-- Add more options as needed -->
                        </select>
                        <button type="button" onclick="removeField(this, 'commonDropdownContainer')">Remove</button><br>
                    </div>
                </div>
            </div>
            <button type="button" onclick="addField('commonDropdownContainer', 'commonDropdown', true)">Add Common Dropdown</button><br>
        </div>

        <!-- Site Specific Cache Check -->
        <label for="siteSpCacheCheck">Site SP Cache Check: </label>
        <input th:checked="*{siteSpCacheCheck}" type="checkbox" value="on" id="siteSpCacheCheck" th:field="*{siteSpCacheCheck}" onclick="togglePanel(this,'siteSpCachePanel')" /><br>

        <div id="siteSpCachePanel" style="display: none;">
            <div id="siteSpCachePathContainer">
                <div th:each="path, iterStat : ${selectedSiteConfig.siteSpCachePath}">
                    <div class="field-container" id="siteSpCachePathField-[[${iterStat.index}]]">
                        <label th:for="'siteSpCachePath' + ${iterStat.index}">Site SP Cache Path (#{iterStat.index + 1}): </label>
                        <input type="text" th:id="'siteSpCachePath' + ${iterStat.index}" th:field="*{siteSpCachePath[__${iterStat.index}__]}" />
                        <button type="button" onclick="removeField(this, 'siteSpCachePathContainer')">Remove</button><br>
                    </div>
                </div>
            </div>
            <button type="button" onclick="addField('siteSpCachePathContainer', 'siteSpCachePath', false)">Add Site SP Cache Path</button><br>

            <div id="siteSpDropdownContainer">
                <div th:each="dropdown, iterStat : ${selectedSiteConfig.siteSpDropdown}">
                    <div class="field-container" id="siteSpDropdownField-[[${iterStat.index}]]">
                        <label th:for="'siteSpDropdown' + ${iterStat.index}">Site SP Dropdown (#{iterStat.index + 1}): </label>
                        <select th:id="'siteSpDropdown' + ${iterStat.index}" th:field="*{siteSpDropdown[__${iterStat.index}__]}">
                            <option value="" disabled>Select Option</option>
                            <option value="Option1">Option 1</option>
                            <option value="Option2">Option 2</option>
                            <option value="Option3">Option 3</option>
                            <!-- Add more options as needed -->
                        </select>
                        <button type="button" onclick="removeField(this, 'siteSpDropdownContainer')">Remove</button><br>
                    </div>
                </div>
            </div>
            <button type="button" onclick="addField('siteSpDropdownContainer', 'siteSpDropdown', true)">Add Site SP Dropdown</button><br>
        </div>

        <button type="submit">Update</button>
    </form>
</div>

<script>
    function addField(containerId, fieldName, isDropdown) {
        var container = document.getElementById(containerId);
        var index = container.children.length;
        var newField = document.createElement('div');
        newField.className = 'field-container';

        if (isDropdown) {
            newField.innerHTML = '<label for="' + fieldName + index + '">' + fieldName + ' (' + (index + 1) + '): </label>' +
                '<select id="' + fieldName + index + '" name="' + fieldName + '[' + index + ']">' +
                '<option value="" disabled>Select Option</option>' +
                '<option value="Option1">Option 1</option>' +
                '<option value="Option2">Option 2</option>' +
                '<option value="Option3">Option 3</option>' +
                '</select>' +
                '<button type="button" onclick="removeField(this, \'' + containerId + '\')">Remove</button>';
        } else {
            newField.innerHTML = '<label for="' + fieldName + index + '">' + fieldName + ' (' + (index + 1) + '): </label>' +
                '<input type="text" id="' + fieldName + index + '" name="' + fieldName + '[' + index + ']" />' +
                '<button type="button" onclick="removeField(this, \'' + containerId + '\')">Remove</button>';
        }

        container.appendChild(newField);
    }

    function removeField(button, containerId) {
        var container = document.getElementById(containerId);
        button.parentElement.remove();
    }

    function togglePanel(checkbox, panelId) {
        var panel = document.getElementById(panelId);
        if (checkbox.checked) {
            panel.style.display = 'block';
        } else {
            panel.style.display = 'none';
        }
    }
</script>

</body>
</html>
